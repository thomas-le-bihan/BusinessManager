(function(django.jQuery){django.jQuery.fn.formset=function(opts)
{var options=django.jQuery.extend({},django.jQuery.fn.formset.defaults,opts);var updateElementIndex=function(el,prefix,ndx){var id_regex=new RegExp('('+prefix+'-\\d+)');var replacement=prefix+'-'+ndx;if(django.jQuery(el).attr("for"))django.jQuery(el).attr("for",django.jQuery(el).attr("for").replace(id_regex,replacement));if(el.id)el.id=el.id.replace(id_regex,replacement);if(el.name)el.name=el.name.replace(id_regex,replacement);};django.jQuery(this).each(function(i){django.jQuery(this).addClass(options.formCssClass);if(django.jQuery(this).is('TR')){django.jQuery(this).children(':last').append('<a class="'+options.deleteCssClass+'" href="javascript:void(0)">'+options.deleteText+'</a>');}else if(django.jQuery(this).is('UL')||django.jQuery(this).is('OL')){django.jQuery(this).append('<li><a class="'+options.deleteCssClass+'" href="javascript:void(0)">'+options.deleteText+'</a></li>');}else{django.jQuery(this).append('<a class="'+options.deleteCssClass+'" href="javascript:void(0)">'+options.deleteText+'</a>');}
django.jQuery(this).find('a.'+options.deleteCssClass).click(function(){var row=django.jQuery(this).parents('.'+options.formCssClass);row.remove();if(options.removed)options.removed(row);var forms=django.jQuery('.'+options.formCssClass);django.jQuery('#id_'+options.prefix+'-TOTAL_FORMS').val(forms.length);if(forms.length==1){django.jQuery('a.'+options.deleteCssClass).hide();}
for(var i=0,formCount=forms.length;i<formCount;i++){django.jQuery(forms.get(i)).find('input,select,textarea,label').each(function(){updateElementIndex(this,options.prefix,i);});}
return false;});});if(django.jQuery(this).length){var django.jQueryaddBtn;if(django.jQuery(this).attr('tagName')=='TR'){var numCols=this.eq(0).children().length;django.jQuery(this).parent().append('<tr><td colspan="'+numCols+'"><a class="'+options.addCssClass+'" href="javascript:void(0)">'+options.addText+'</a></tr>');django.jQueryaddBtn=django.jQuery(this).parent().find('tr:last a');}else{django.jQuery(this).filter(':last').after('<a class="'+options.addCssClass+'" href="javascript:void(0)">'+options.addText+'</a>');django.jQueryaddBtn=django.jQuery(this).filter(':last').next();}
django.jQueryaddBtn.click(function(){var nextIndex=parseInt(django.jQuery('#id_'+options.prefix+'-TOTAL_FORMS').val());var row=django.jQuery('.'+options.formCssClass+':first').clone(true).get(0);django.jQuery(row).removeAttr('id').insertAfter(django.jQuery('.'+options.formCssClass+':last'));django.jQuery(row).find('input,select,textarea,label').each(function(){updateElementIndex(this,options.prefix,nextIndex);var elem=django.jQuery(this);if(elem.is('input:checkbox')||elem.is('input:radio')){elem.attr('checked',false);}else{elem.val('');}});var formCount=nextIndex+1;django.jQuery('#id_'+options.prefix+'-TOTAL_FORMS').val(formCount);if(formCount>1){django.jQuery('a.'+options.deleteCssClass).show();}
if(options.added)options.added(django.jQuery(row));return false;});}
if(django.jQuery(this).length==1){django.jQuery('a.'+options.deleteCssClass).hide();}
return django.jQuery(this);}
django.jQuery.fn.formset.defaults={prefix:'form',addText:'add another',deleteText:'remove',addCssClass:'add-row',deleteCssClass:'delete-row',formCssClass:'dynamic-form',added:null,removed:null}})(jQuery)
